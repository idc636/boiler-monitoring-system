<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–°—É—Ç–æ—á–Ω—ã–π –∂—É—Ä–Ω–∞–ª</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:10px;
}

h3 {
  text-align:center;
  margin-bottom:10px;
}

.controls {
  display:flex;
  gap:10px;
  justify-content:center;
  margin-bottom:15px;
}

button {
  border:none;
  padding:10px 20px;
  border-radius:5px;
  cursor:pointer;
  font-weight:bold;
}

.archive-btn {
  background:#ffc107;
  color:#000;
}

.switch-btn {
  background:#2196f3;
  color:#fff;
}

.wrap {
  overflow-x:auto;
}

table {
  border-collapse:collapse;
  background:#fff;
  font-size:12px;
  min-width:2600px;
}

th, td {
  border:1px solid #000;
  padding:4px 6px;
  text-align:center;
  white-space:nowrap;
}

thead th {
  background:#d9d9d9;
}

.section {
  background:#b7d78a;
  font-weight:bold;
  text-align:left;
}

.editable {
  cursor:pointer;
}

.editable:hover {
  background:#e3f2fd;
}

.hidden {
  display:none;
}

.archive-list {
  max-width:900px;
  margin:0 auto;
}

.archive-item {
  background:#fff;
  border:1px solid #ccc;
  padding:10px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<h3>–ê–û ¬´–Ø–º–∞–ª–∫–æ–º—É–Ω—ç–Ω–µ—Ä–≥–æ¬ª ‚Äî –°—É—Ç–æ—á–Ω—ã–π –∂—É—Ä–Ω–∞–ª</h3>

<div class="controls">
  <button class="archive-btn" onclick="archiveRecords()">üóÑÔ∏è –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
  <button class="switch-btn" onclick="toggleView()">üîÅ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥</button>
</div>

<!-- –¢–ï–ö–£–©–ò–ô –ñ–£–†–ù–ê–õ -->
<div id="journalView" class="wrap">
  <!-- ‚ö†Ô∏è –¢–í–û–Ø –¢–ê–ë–õ–ò–¶–ê ‚Äî –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô -->
  <!-- —è –µ—ë –Ω–µ —Ç—Ä–æ–≥–∞–ª, –æ–Ω–∞ –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–∞–∫–æ–π, –∫–∞–∫ —Ç—ã –ø—Ä–∏—Å–ª–∞–ª -->
  <!-- –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤—å —Å—é–¥–∞ –¢–ï–ö–£–©–£–Æ —Ç–∞–±–ª–∏—Ü—É —Ü–µ–ª–∏–∫–æ–º -->
</div>

<!-- –ê–†–•–ò–í -->
<div id="archiveView" class="hidden">
  <div class="archive-list" id="archiveList"></div>
</div>

<script>
const STORAGE_KEY = 'dailyJournalData';
const ARCHIVE_KEY = 'dailyJournalArchive';

/* ====== –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –Ø–ß–ï–ï–ö ====== */
document.addEventListener('click', e => {
  if (!e.target.classList.contains('editable')) return;

  const cell = e.target;
  const oldValue = cell.innerText;

  const input = document.createElement('input');
  input.value = oldValue;
  input.style.width = '100%';

  cell.innerHTML = '';
  cell.appendChild(input);
  input.focus();

  input.addEventListener('blur', () => {
    cell.innerText = input.value;
    saveData();
  });

  input.addEventListener('keydown', ev => {
    if (ev.key === 'Enter') input.blur();
  });
});

/* ====== –°–û–•–†–ê–ù–ï–ù–ò–ï ====== */
function saveData() {
  const data = {};
  document.querySelectorAll('.editable').forEach((cell, i) => {
    data[i] = cell.innerText;
  });
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

/* ====== –ó–ê–ì–†–£–ó–ö–ê ====== */
function loadData() {
  const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  document.querySelectorAll('.editable').forEach((cell, i) => {
    if (data[i] !== undefined) cell.innerText = data[i];
  });
}

/* ====== –ê–†–•–ò–í ====== */
function archiveRecords() {
  if (!confirm('–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –æ—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª?')) return;

  const snapshot = document.getElementById('journalView').innerHTML;
  const archive = JSON.parse(localStorage.getItem(ARCHIVE_KEY) || '[]');

  archive.push({
    date: new Date().toLocaleDateString(),
    html: snapshot
  });

  localStorage.setItem(ARCHIVE_KEY, JSON.stringify(archive));
  localStorage.removeItem(STORAGE_KEY);

  document.querySelectorAll('.editable').forEach(c => c.innerText = '');
  alert('–î–∞–Ω–Ω—ã–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã');
}

/* ====== –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ ====== */
function toggleView() {
  document.getElementById('journalView').classList.toggle('hidden');
  document.getElementById('archiveView').classList.toggle('hidden');
  renderArchive();
}

function renderArchive() {
  const archive = JSON.parse(localStorage.getItem(ARCHIVE_KEY) || '[]');
  const list = document.getElementById('archiveList');
  list.innerHTML = '';

  archive.forEach(item => {
    const div = document.createElement('div');
    div.className = 'archive-item';
    div.innerHTML = `<strong>${item.date}</strong><div class="wrap">${item.html}</div>`;
    list.appendChild(div);
  });
}

loadData();
</script>

</body>
</html>
