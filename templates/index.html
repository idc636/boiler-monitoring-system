<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Журнал котлов</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        h1 { margin-bottom: 10px; }
        .user-info { margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; background: #fff; }
        th, td { border: 1px solid #ccc; padding: 6px; text-align: center; font-size: 14px; }
        th { background: #eee; }
        tr:nth-child(even) { background: #fafafa; }
        .btn { padding: 6px 12px; margin-right: 10px; background: #007bff; color: #fff; border: none; cursor: pointer; border-radius: 4px; }
        .btn:hover { background: #0056b3; }
        .status-work { background: #d4edda; }   /* зелёный для работы */
        .status-reserve { background: #fff3cd; } /* жёлтый для резерва */
        .status-repair { background: #f8d7da; }  /* красный для ремонта */
    </style>
</head>
<body>
    <h1>Журнал котлов</h1>
    <div class="user-info">
        Пользователь: {{ user.username }} ({{ user.role }})<br>
        <button class="btn" onclick="archive()">Архивировать</button>
        <button class="btn" onclick="addRecord()">Добавить</button>
        <a href="{{ url_for('logout') }}" class="btn">Выйти</a>
    </div>
    <table>
        <thead>
            <tr>
                <th>№</th>
                <th>Модель</th>
                <th>Год</th>
                <th>Время</th>
                <th>Котлы</th>
                <th>Сетевые насосы</th>
                <th>Подпиточные насосы</th>
                <th>Температура</th>
                <th>По графику</th>
                <th>Давление</th>
                <th>Вода</th>
                <th>Ночь</th>
                <th>День</th>
                <th>Примечания</th>
            </tr>
        </thead>
        <tbody>
        {% for b in boilers %}
            {% for i in range(b.rows) %}
            <tr>
                <td>{{ b.number }}</td>
                <td>{{ b.boiler_models[i] }}</td>
                <td>
                    {% for y in b.years %}
                        {% if i >= y.start and i < y.start + y.span %}
                            {{ y.year }}
                        {% endif %}
                    {% endfor %}
                </td>
                <td>{{ b.times[i] }}</td>

                <!-- Котлы -->
                <td class="{% if b.boilers.repair %}status-repair{% elif b.boilers.work[i] %}status-work{% else %}status-reserve{% endif %}">
                    {{ b.boilers.work[i] }} / {{ b.boilers.reserve[i] }}
                </td>

                <!-- Сетевые насосы -->
                <td class="{% if b.network_pumps.repair %}status-repair{% elif b.network_pumps.work[i] %}status-work{% else %}status-reserve{% endif %}">
                    {{ b.network_pumps.work[i] }} / {{ b.network_pumps.reserve[i] }}
                </td>

                <!-- Подпиточные насосы -->
                <td class="{% if b.feed_pumps.repair %}status-repair{% elif b.feed_pumps.work[i] %}status-work{% else %}status-reserve{% endif %}">
                    {{ b.feed_pumps.work[i] }} / {{ b.feed_pumps.reserve[i] }}
                </td>

                <!-- Температуры -->
                <td>{{ b.temps[i][0] }} / {{ b.temps[i][1] }} / {{ b.temps[i][2] }}</td>
                <td>{{ b.graph_temps[i][0] }} / {{ b.graph_temps[i][1] }}</td>
                <td>{{ b.pressure[i][0] }} / {{ b.pressure[i][1] }}</td>
                <td>{{ b.water_consumption }}</td>
                <td>{{ b.staff.night }}</td>
                <td>{{ b.staff.day }}</td>
                <td>{{ b.notes }}</td>
            </tr>
            {% endfor %}
        {% endfor %}
        </tbody>
    </table>

    <script>
        function archive() {
            if(!confirm('Вы уверены, что хотите архивировать и очистить таблицу?')) return;
            fetch('/archive', { method: 'POST' })
                .then(res => res.json())
                .then(data => alert(data.message))
                .then(() => location.reload());
        }

        function addRecord() {
            fetch('/add', { method: 'POST' })
                .then(res => res.json())
                .then(data => location.reload());
        }
    </script>
</body>
</html>
