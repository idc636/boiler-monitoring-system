{% if is_admin %}
<button id="add-record-btn">➕ Добавить запись</button>
{% endif %}

<script>
document.querySelectorAll('.editable').forEach(cell => {
    {% if not is_admin %}
    // обычные пользователи не могут редактировать
    return;
    {% endif %}
    cell.addEventListener('click', function() {
        const field = this.getAttribute('data-field');
        const id = this.getAttribute('data-id');
        const currentValue = this.textContent;

        const input = document.createElement('input');
        input.type = 'text';
        input.value = currentValue;

        input.addEventListener('blur', function() {
            const newValue = this.value;
            fetch('/update', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({field, value: newValue, id})
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'ok') cell.textContent = newValue;
                else alert('Ошибка сохранения');
            }).catch(()=>alert('Ошибка связи с сервером'));
        });

        input.addEventListener('keypress', e => { if(e.key==='Enter') this.blur(); });

        this.innerHTML='';
        this.appendChild(input);
        input.focus();
    });
});

// кнопка "Добавить запись"
const addBtn = document.getElementById('add-record-btn');
if(addBtn){
    addBtn.addEventListener('click', () => {
        fetch('/add_record', {method:'POST'})
        .then(res=>res.json())
        .then(data=>{
            if(data.status==='ok') location.reload();
        });
    });
}
</script>
